---
title: "p8105_hw2_yd2739"
author: "Yuxuan Du"
date: "2023-09-26"
output: github_document
---

## Problem 1

We'll use the data in `pols-month.csv`, `unemployment.csv`, and `snp.csv`

**load `pols-month.csv`**
```{r}
library(tidyverse)
pols_month_df = 
  read_csv("HW2_P1_DATA/pols-month.csv")|>
  janitor::clean_names()|>
  separate(
    col = mon,
    into = c("year", "month", "day"), 
    sep = "-") |>
  mutate(
    month = case_match(
      month, 
      '01' ~ "January", 
      '02' ~ "February", 
      '03' ~ "March", 
      '04' ~ "April", 
      '05' ~ "May", 
      '06' ~ "June", 
      '07' ~ "July", 
      '08' ~ "August", 
      '09' ~ "September", 
      '10' ~ "October", 
      '11' ~ "November", 
      '12' ~ "December"
    )
  )|>
  mutate(
    president = case_match(
      prez_gop, 
      2 ~ "republican",
      1 ~ "republican", 
      0 ~ "democratic"
    )
  )|>
  subset(select = -c(prez_gop, prez_dem, day))
pols_month_df
```

**load `snp.csv`**
```{r}
snp_df = 
  read_csv("HW2_P1_DATA/snp.csv")|>
  janitor::clean_names()|>
  separate(
    col = date,
    into = c("month", "day", "year"), 
    sep = "/") |>
  mutate(
    month = case_match(
      month, 
      '1' ~ "January", 
      '2' ~ "February", 
      '3' ~ "March", 
      '4' ~ "April", 
      '5' ~ "May", 
      '6' ~ "June", 
      '7' ~ "July", 
      '8' ~ "August", 
      '9' ~ "September", 
      '10' ~ "October", 
      '11' ~ "November", 
      '12' ~ "December"
    )
  )|>
  mutate(
    year = as.numeric(year)
  )|>
  mutate(
    year = ifelse(year>=50, 1900+year, 2000+year), 
    year = as.character(year)
  )|>
  relocate(c(year, month))
snp_df
```

**load`unemployment.csv`**
```{r}
unemployment_df = 
  read_csv("HW2_P1_DATA/unemployment.csv")|>
  janitor::clean_names()|>
  pivot_longer(
    jan:dec, 
    names_to = "month",
    values_to = "unemployment", 
  )|>
  mutate(
    year = as.character(year)
  )|>
  mutate(
    month = case_match(
      month, 
      'jan' ~ "January", 
      'feb' ~ "February", 
      'mar' ~ "March", 
      'apr' ~ "April", 
      'may' ~ "May", 
      'jun' ~ "June", 
      'jul' ~ "July", 
      'aug' ~ "August", 
      'sep' ~ "September", 
      'oct' ~ "October", 
      'nov' ~ "November", 
      'dec' ~ "December"
    )
  )
unemployment_df
```
**merge three dataframe**
```{r}
P1_whole_df = 
  left_join(pols_month_df, snp_df, by = c("year", "month"))|>
  left_join(unemployment_df, by = c("year", "month"))
P1_whole_df
```

So the pols_month dataset contains the information of president, governors, senators, and representatives from republican and democratic during different period of time. 

The snp dataset contains the Standard & Poorâ€™s stock market index during different period of time. 

The unemployment dataset contains the unemployment rate in the US during different period of time. 

The time span of the dataset is from 1947 to 2015. The size of the merged dataset is 822 x 12. 



## Problem 2
```{r}
# load the dataset, change the format of date, recalculate homes_powered
mr_trash_wheel_df = 
  readxl::read_excel("HW2_P2_DATA/202207 Trash Wheel Collection Data.xlsx", sheet = "Mr. Trash Wheel", range = "A2:N549")|>
  janitor::clean_names()|>
  mutate(
    date = substr(date, nchar(date) - 1, nchar(date))
  )|>
  mutate(
    homes_powered = (weight_tons*500/30)
  )|>
  mutate(name = "Mr_trash_wheel")
mr_trash_wheel_df
```
```{r}
professor_trash_wheel_df = 
  readxl::read_excel("HW2_P2_DATA/202207 Trash Wheel Collection Data.xlsx", sheet = "Professor Trash Wheel", range = "A2:M96")|>
  janitor::clean_names()|>
  mutate(
    date = substr(date, nchar(date) - 1, nchar(date))
  )|>
  mutate(
    homes_powered = (weight_tons*500/30), 
    year = as.character(year)
  )|>
  mutate(name = "Professor_trash_wheel")
professor_trash_wheel_df
```

```{r}
gwynnda_trash_wheel_df = 
  readxl::read_excel("HW2_P2_DATA/202207 Trash Wheel Collection Data.xlsx", sheet = "Gwynnda Trash Wheel", range = "A2:K108")|>
  janitor::clean_names()|>
  mutate(
    date = substr(date, nchar(date) - 1, nchar(date))
  )|>
  mutate(
    homes_powered = (weight_tons*500/30),
    year = as.character(year)
  )|>
  mutate(name = "Gwynnda_trash_wheel")

trash_wheel_collection_df = 
  bind_rows(mr_trash_wheel_df, professor_trash_wheel_df, gwynnda_trash_wheel_df)

total_weight_professor = sum(pull(professor_trash_wheel_df, weight_tons))

total_cigarette_butts_gwynnda_july_2021 = subset(
  gwynnda_trash_wheel_df, 
  month == "July" & year == "2021"
  )|>
  pull(
    cigarette_butts
    )|>
  sum()
gwynnda_trash_wheel_df
```

The size of the merged dataframe is 747 x 14.  

Some interesting information: Only Mr.Trash Wheel has the variable of `sports_ball`;

Gwynnda Trash Wheel does not have the variable `galss_bottles`;

The category in Gwynnda dataset contains a category of `plastic_bags`, but it does not include category `grocery_bags` and `chip_bags` that exist in other two dataset. This might be an inconsistency in variable names, but I didn't change the format. 

The way of recording date is kind of redundant since there are variables for year and month (the format of date is changed later)

There might be missing data in the dataset gwynnda_trash_wheel_df since there are days they collected tons of trash while all trash category counts is 0. 

The total weight of trash collected by Professor Trash Wheel is `r total_weight_professor`. 

The total number of cigarette butts collected by Gwynnda in July of 2021 is `r total_cigarette_butts_gwynnda_july_2021`. 

## Problem 3

```{r}
demo_info_df = 
  read_csv("HW2_P3_DATA/MCI_baseline.csv", skip = 1)|>
  janitor::clean_names()|>
  mutate(
    sex = recode(sex, "1" = "male", "0" = "female"),
    apoe4 = recode(apoe4, "1" = "carrier", "0" = "non-carrier"), 
    sex = factor(sex), 
    apoe4 = factor(apoe4)
  )|>
  subset(
    current_age < age_at_onset | age_at_onset == "."
  )|>
  rename(
    age_starting = current_age
  )
head(demo_info_df)

avg_age_baseline = mean(pull(demo_info_df, age_starting))

total_women = subset(
  demo_info_df, 
  sex == "female"
  )|>
  nrow()

total_women_carrier = subset(
  demo_info_df, 
  sex == "female" & apoe4 == "carrier"
  )|>
  nrow()

women_apoe4_percent = total_women_carrier/total_women
```

We can seee that there are 479 people met the requirement and joined the experiment, 
93 of the 479 developed MCI at last. The average baseline age is `r avg_age_baseline`. 
The proportion of women in the study who are APOE4 carriers is `r women_apoe4_percent`. 

```{r}
amyloid_df = 
  read_csv("HW2_P3_DATA/mci_amyloid.csv", skip = 1)|>
  janitor::clean_names()|>
  rename(
    id=study_id, 
    ratio_base_line = baseline, 
    ratio_second_year = time_2, 
    ratio_fourth_year = time_4, 
    ratio_sixth_year = time_6, 
    ratio_eighth_year = time_8)
head(amyloid_df)
```

We also need to skip the first line of mci_amyloid.csv since it is not the header for dataframe. Also to follow the format of `demo_info_df`, the variable `study_id` is renamed as `id`. There are missing values in dataset, but it might means they didn't show up at that time. The size of the dataframe is 487 x 6. 

```{r}
only_baseline = demo_info_df |>
  anti_join(amyloid_df, by = "id")
head(only_baseline)

only_amyloid = amyloid_df |>
  anti_join(demo_info_df, by = "id")
head(only_amyloid)

both_df = merge(demo_info_df, amyloid_df)
head(both_df)
write.csv(both_df, "HW2_P3_DATA/merged.csv", row.names = FALSE)

female_count = nrow(filter(both_df, sex == "female"))

male_count = nrow(filter(both_df, sex == "male"))

MCI_count = nrow(filter(both_df, age_at_onset != '.'))
```

There are 16 participants appear only in the amyloid dataset and 8 participants appear only in the baseline dataset. 

For the merged dataset, there are 471 observation, each with 11 variables. 

There are `r female_count` female participant and `r male_count` male participant both appeared in two dataset, and there are `r MCI_count` participant who developed MCI at last. 